<div class="remedia-container" *ngIf="showChannels">
  <mat-sidenav-container *ngIf="showChannelsTable" class="remedia-sidenav-container"  style="height: 100vh;">
    <mat-sidenav-content>
      <app-s-table-new aria-label="channels" role="table" [sTableOptions]="channelsTableOptions"
        (sortCallback)="channelssortCall($event)"
        (filterCallback)="channelsfilterCall($event)"
        (colFilterCallback)="channelsColFilterCall($event)"
        (actionCallback)="channelsactionCall($event)"
        (pageCallback)="channelspageCall($event)" (refreshCallback)="getChannels()"
        (addCallback)="channelsaddTableData()"
        (timerCallback)="channelstimerCallData()"
        (finalQueryCallback)="queryFilterCallBack($event)">
      </app-s-table-new>
    </mat-sidenav-content>
    <mat-sidenav #channel [mode]="'over'" fixedTopGap="56" position="end" class="w-70p z-index-150">
      <mat-card class="w-100">
        <button class="float-right r-1p mt--10" mat-icon-button aria-label="close modal icon" matTooltip="Close"
          (click)="channel.close();"><mat-icon>close</mat-icon>
        </button>
        <mat-card-header>
          <mat-card-title>Add Channel</mat-card-title>
        </mat-card-header>
        <form #adch="ngForm" name="credentials" autocomplete="off">
          <mat-card-content>
            <mat-form-field appearance="outline" class="col-md-8">
              <mat-label>Title</mat-label>
              <input matInput type="text" [(ngModel)]="channelData.title" placeholder="Enter title" required name="title" id="name">
              <mat-error> Title is required</mat-error>
            </mat-form-field>
            <mat-form-field class="col-md-8 w-70p" appearance="outline">
              <mat-select class="inp-width" [formControl]="userCtrl" required (selectionChange)="channelData.celebrity_id = $event.value" (openedChange)="closeCurrentUser($event)" placeholder="Search celebrity" #userSelect>
                <mat-option>
                  <ngx-mat-select-search [formControl]="userFilterCtrl" [placeholderLabel]="'Search celebrity'"
                    [noEntriesFoundLabel]="'No matching celebrity found'" [searching]="searching"></ngx-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let user of filteredUsers | async" [value]="user._id">
                  {{user.name}}
                </mat-option>
              </mat-select>
              <mat-error> Celebrity is required</mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" class="mr-3 col-md-8">
              <mat-label>Video</mat-label>
              <input matInput type="url" name="video" [(ngModel)]="channelData.video_link" placeholder="Enter video url" required>
              <mat-error>Video is required</mat-error>
            </mat-form-field>
            <mat-form-field class="col-md-8 w-70p" appearance="outline">
              <mat-label>Select Category</mat-label>
              <mat-select [multiple]="true" required placeholder="Choose category" name="roleLists" [(ngModel)]="channelData.category">
                <mat-option *ngFor="let item of categoryList"
                  [value]="item._id" [id]="item._id">
                  {{item.name}}
                </mat-option>
              </mat-select>
              <mat-error> Category is required</mat-error>
            </mat-form-field>         
            <ng-container *ngFor="let item of channelData.description; let i = index">
              <mat-expansion-panel class="mt-2" [expanded]="step === i" (opened)="setStep(i)" hideToggle>
                <mat-expansion-panel-header>
                  <mat-panel-title class="mt-2">Description</mat-panel-title>
                  <div class="ml-2 mt-2">
                    <button mat-button="" *ngIf="i===0" class="tprime px-1 mr-2" (click)="addDes()" appPreventMultiClick>
                          <span class="d-flex flex-row align-items-center">
                            <i class="ms-Icon ms-font-lg ms-Icon--BoxAdditionSolid px-1 ms-fontColor-themePrimary"></i>
                            <span class="ibtn pl-1" id="DepAssetAddAsset">Add</span>
                          </span>
                    </button>
                    <button mat-button="" *ngIf="i!==0"class="mat-warn px-1 mr-2" (click)="removeDes(i)" appPreventMultiClick matTooltip="Delete language">
                      <span class="d-flex flex-row align-items-center">
                        <i class="ms-Icon ms-font-lg ms-Icon--Delete px-1 ms-fontColor-themeDanger"></i>
                        <span class="ibtn pl-1" id="aDeleteCompany">Delete</span>
                      </span>
                    </button>
                  </div>
                </mat-expansion-panel-header>
                <mat-card class="mt-2 mb-2">
                  <mat-form-field class="col-md-8 w-70p" appearance="outline">
                    <mat-label>Language</mat-label>
                    <mat-select [multiple]="false" required placeholder="Choose language" name="langLists{{i}}" [(ngModel)]="item.language">
                      <mat-option *ngFor="let lang of languagesList" [value]="lang" [id]="lang"> {{lang}} </mat-option>
                    </mat-select>
                    <mat-error> Language is required</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-8">
                    <mat-label>Title</mat-label>
                    <input matInput type="text" [(ngModel)]="item.title" placeholder="Enter title" name="title{{i}}" id="name">
                    <mat-error> Title is required</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-8">
                    <mat-label>Description</mat-label>
                      <textarea matInput type="text" cols="4" [(ngModel)]="item.description" placeholder="Enter description" name="keyt{{i}}" id="keyt"></textarea>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-8">
                    <mat-label>Short Description</mat-label>
                      <textarea matInput type="text" cols="4" [(ngModel)]="item.short_description" placeholder="Enter short description" name="keys{{i}}" id="keys"></textarea>
                  </mat-form-field>
                  <mat-checkbox name="primary{{i}}" (change)="isPrimary(i, $event)" [(ngModel)]="item.is_default" value="" class="pt-2 mr-3 col-md-12 mb-3" color="primary">
                    Is default? </mat-checkbox>
                  <div *ngFor="let list of item.key_takeaways; let j = index" class="row">
                    <mat-form-field class="ml-3 col-md-8 w-70p" appearance="outline">
                      <mat-label>Key Takeaway</mat-label>
                        <textarea matInput type="text" cols="4" [(ngModel)]="list.name" placeholder="Enter key takeaway" required name="keyt{{i}}{{j}}" id="keyt"></textarea>
                      <mat-error> Key Takeaway is required</mat-error>
                    </mat-form-field>
                    <div class="ml-2 mt-2">
                      <button mat-button="" *ngIf="j===0" class="tprime px-1 mr-2" (click)="addTakeawayKey(j)" appPreventMultiClick>
                        <span class="d-flex flex-row align-items-center">
                          <i class="ms-Icon ms-font-lg ms-Icon--BoxAdditionSolid px-1 ms-fontColor-themePrimary"></i>
                          <span class="ibtn pl-1" id="DepAssetAddAsset">Add</span>
                        </span>
                      </button>
                      <button mat-button="" *ngIf="j!==0"class="mat-warn px-1 mr-2" (click)="removeTakeawayKey(i, j)" appPreventMultiClick matTooltip="Delete key takeaway">
                        <span class="d-flex flex-row align-items-center">
                          <i class="ms-Icon ms-font-lg ms-Icon--Delete px-1 ms-fontColor-themeDanger"></i>
                          <span class="ibtn pl-1" id="aDeleteCompany">Delete</span>
                        </span>
                      </button>
                    </div>
                  </div>
                  <mat-form-field appearance="outline" class="col-md-8">
                    <mat-label>Mini Announcement</mat-label>
                    <input matInput type="text" [(ngModel)]="item.mini_announcement" placeholder="Enter Mini Announcement" required name="mini{{i}}" id="mini">
                    <mat-error> Mini Announcement is required</mat-error>
                  </mat-form-field>
                </mat-card>
              </mat-expansion-panel>
            </ng-container>
          </mat-card-content>
          <div mat-dialog-actions class="mt-2">
            <button type="button" [disabled]="!adch.form.valid" mat-raised-button color="primary" class="mr-2"
              id="adchsavebtn" (click)="saveChannel()">Save
            </button>
            <button mat-raised-button (click)="channel.close();">Cancel</button>
          </div>
        </form>
      </mat-card>
    </mat-sidenav>
    <mat-sidenav #channelupload [mode]="'over'" fixedTopGap="56" class="w-50 z-index-150" position="end">
      <mat-card class="mat-elevation-z0 w-100">
        <button class="position-absolute r-1p mt--10" mat-icon-button (click)="channelupload.close()"> <mat-icon>close</mat-icon> </button>
        <mat-card-header>
          <mat-card-title>Upload Images</mat-card-title>
        </mat-card-header>
        <form #channelupload="ngForm" name="upload" autocomplete="off">
          <mat-card-content>
            <div class="row row-fix">
              <div class="col-lg-12">
                <div class="mat-card modal">
                  <p class="mb-3">Preview Image</p>
                  <input type="file" name="file" (change)="uploadFile($event, 'preview_images')"/>
                  <img *ngIf="preview_images" width="169" height="128" [src]="preview_images" alt="">
                  <hr class="mt-4 mb-4">
                </div>
                <div class="flex flex-row align-items-center mt-3">
                  <button mat-raised-button color="primary"
                    [disabled]="!preview_images"
                    class="mr20" (click)="imagesUpload()" >Upload Images
                  </button>
                  <button mat-button class="ml-2" color="assent" (click)="preview_images= ''">Reset</button>
                </div>
              </div>
            </div>
          </mat-card-content>
        </form>
      </mat-card>
    </mat-sidenav>
  </mat-sidenav-container>
</div>